


    




<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "posts",
        "name" : "Sieve of Eratosthenes (Memory Efficient Implementation)",
        "headline" : "Sieve of Eratosthenes (Memory Efficient Implementation)",
        "description" : "A memory efficient technique for prime number generation",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2017",
        "datePublished": "2017-08-16 00:30:00 \u002b0000 \u002b0000",
        "dateModified" : "2017-08-16 00:30:00 \u002b0000 \u002b0000",
        "url" : "\/posts\/sieve-of-eratosthenes-memory-efficient-implementation\/",
        "wordCount" : "550",
        "keywords" : [ "algorithms","math","prime-number","number-theory","Blog" ]
    }
    </script>
        
            <title>Sieve of Eratosthenes (Memory Efficient Implementation) - Rimon Mostafiz</title>
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.77.0" />
        


        
            <meta name="author" content="Rimon Mostafiz">
        
        
            <meta name="description" content="A memory efficient technique for prime number generation">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sieve of Eratosthenes (Memory Efficient Implementation)"/>
<meta name="twitter:description" content="A memory efficient technique for prime number generation"/>
<meta name="twitter:site" content="@rimonmostafiz"/>

        <meta property="og:title" content="Sieve of Eratosthenes (Memory Efficient Implementation)" />
<meta property="og:description" content="A memory efficient technique for prime number generation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/sieve-of-eratosthenes-memory-efficient-implementation/" />
<meta property="article:published_time" content="2017-08-16T00:30:00+00:00" />
<meta property="article:modified_time" content="2017-08-16T00:30:00+00:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Sieve of Eratosthenes (Memory Efficient Implementation)">
<meta itemprop="description" content="A memory efficient technique for prime number generation">
<meta itemprop="datePublished" content="2017-08-16T00:30:00+00:00" />
<meta itemprop="dateModified" content="2017-08-16T00:30:00+00:00" />
<meta itemprop="wordCount" content="550">



<meta itemprop="keywords" content="algorithms,math,prime-number,number-theory," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-127460370-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
<header id="header">
    
      <h1><a href="/">posts</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/pages/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/blog/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/pages/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/blog/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/get-insulted-by-sudo/">Get Insulted by sudo</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-30'>
                                    July 30, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/manage-npm-global-packages/">Manage npm Global Packages</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-29'>
                                    July 29, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/goodbye-wordpress-welcome-to-hugo/">Goodbye Wordpress, Welcome to HUGO</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-27'>
                                    July 27, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/install-and-manage-node-js-using-nvm/">Install and Manage Node JS Using NVM</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-07'>
                                    July 7, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/spring-bean-wiring-using-javaconfig/">Spring Bean Wiring Using Javaconfig</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-05-29'>
                                    May 29, 2018</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    
    <div id="main">
        <article class="post">
            
            <header>
    <div class="title">
        
            <h1><a href="/posts/sieve-of-eratosthenes-memory-efficient-implementation/">Sieve of Eratosthenes (Memory Efficient Implementation)</a></h1>
            
        
        
            <p>A memory efficient technique for prime number generation</p>
        
    </div>
</header>

            <div id="content">
                <p>Say we want to find all prime numbers up to an integerÂ <strong>N</strong> where <strong>N</strong> isÂ <strong>10<!-- raw HTML omitted -->8<!-- raw HTML omitted --></strong>.Â If we write a regular implementation ofÂ <a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve Of Eratosthenes</a>Â using a bool arrayÂ for each integer in the range <code>[1:N]</code>Â then we could end up usingÂ <strong>N</strong> bytes of memory, which would roughly be <strong>95Â MB</strong>Â which is a not a very small memory.</p>
<p>Lets see how can weÂ reduce the memory, the main idea here is we can store aÂ BooleanÂ value in a single bit, soÂ weÂ can store <strong>8Â Boolean</strong>Â values in a single byte. Yet another idea is we knowÂ there is only one even prime number which is <strong>2</strong> so weÂ don&rsquo;tÂ need to calculate for other even numbers. With this in mind we can reduceÂ the memoryÂ requirementÂ half by simply not storing information for even numbers, butÂ obviouslyÂ weÂ need toÂ handle this only even number <strong>2</strong> on our own.</p>
<p>With these If we store this information in <strong>4-byte</strong> integers, then we require only <strong>N/32</strong> integers.</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;cstdio&gt;

using namespace std;

#define MAX 100000000  // 10^8
#define LMT 10000      // sqrt of MAX
#define LEN 5800032    // maximum possible different primes

unsigned flag[MAX&gt;&gt;6], primes[LEN];

#define ifc(n) (flag[n&gt;&gt;6]&amp;(1&lt;&lt;((n&gt;&gt;1)&amp;31)))
#define isc(n) (flag[n&gt;&gt;6]|=(1&lt;&lt;((n&gt;&gt;1)&amp;31)))

void sieve() {
    unsigned i, j, k;
    for(i=3; i&lt;LMT; i+=2)
        if(!ifc(i))
            for(j=i*i, k=(i&lt;&lt;1); j&lt;MAX; j+=k)
                isc(j);
    primes[0] = 2;
    for(i=3, k=1; i&lt;MAX; i+=2)
        if(!ifc(i))
            primes[k++] = i;
}

int main() {
    sieve();
    return 0;
}
</code></pre><h3 id="explanation">Explanation:</h3>
<p>Lets talk about the these macros first</p>
<pre><code>#define MAX 100000000 // 10^8
#define LMT 10000 // sqrt of MAX
#define LEN 5800032 // maximum possible different primes
</code></pre><p><strong>MAX</strong> is the maximum range <strong>(10<!-- raw HTML omitted -->8<!-- raw HTML omitted -->)</strong>, we need to calculate our prime numbers up to MAX
<strong>LMT</strong> is the <code>sqrt</code> of MAX, a number <strong>X</strong> is prime if it is not divisible by any prime number up to sqrt of <strong>X</strong>. this is the main idea ofÂ Â <a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve Of Eratosthenes</a>.
<strong>LEN</strong> is size of Array we store out primes.</p>
<p>The variableÂ declarationÂ </p>
<pre><code>unsigned flag[MAX&gt;&gt;6], primes[LEN];
</code></pre>
<p><strong>flag[MAX&raquo;6]</strong> is actually <strong>flag[MAX/64]</strong> andÂ And why we divide <strong>MAX</strong> by <strong>64</strong>Â ? <!-- raw HTML omitted -->
Next the <strong>primes</strong> Array for storing all primes up to <strong>MAX</strong></p>
<p>Now the super macro, which is doing all the things for us</p>
<pre><code>#define ifc(n) (flag[n&gt;&gt;6]&amp;(1&lt;&lt;((n&gt;&gt;1)&amp;31)))
#define isc(n) (flag[n&gt;&gt;6]|=(1&lt;&lt;((n&gt;&gt;1)&amp;31)))
</code></pre><p><code>ifc</code> checks if a specific bit is 1 or 0 <!-- raw HTML omitted -->
<code>isc</code> sets a specific bit 1 to mark it as composite in flag array.</p>
<p>InÂ bit-wiseÂ sieve a specific value <strong>N</strong> located in
<strong>[N/32]<!-- raw HTML omitted -->th<!-- raw HTML omitted --></strong>Â index, and on that index <strong>[N%32]<!-- raw HTML omitted -->th<!-- raw HTML omitted --></strong>Â bit from <strong>LSB</strong>(Right to left).Â But as we areÂ considering theÂ odd numbers only, we can map <strong>N</strong> with <strong>N/2</strong>.</p>
<p>Now if weÂ replace <strong>N</strong> with <strong>N/2</strong>,</p>
<p>The Â <strong>[N/32]th</strong>Â index now becomes <strong>[N/2/32] = [N/64] = [N&raquo;6]</strong> <!-- raw HTML omitted --></p>
<p>And <strong>[N%32]th</strong>Â bit position becomes <strong>((N/2)%32) = (N&raquo;1)&amp;31</strong></p>
<p>We know, modding with a power of <strong>2</strong> is same as <strong>AND</strong> ing <strong>(&amp;)</strong> with <strong>(same power of 2)-1</strong>.</p>
<p>But why we are using bit shifting/Operations? ðŸ˜• <!-- raw HTML omitted -->  Because bit is fun and faster. ðŸ˜‰</p>
<p>This implementation reserves about <strong>[10<!-- raw HTML omitted -->8<!-- raw HTML omitted -->/64] = [MAX&raquo;64]</strong>Â integers for the flag array, which is about <strong>6MB</strong> of memory.Â Since there are <strong>5.8 Million</strong> primes under <strong>10<!-- raw HTML omitted -->8<!-- raw HTML omitted --></strong>, this would require an extra <strong>4 x 5.8 x 10<!-- raw HTML omitted -->6<!-- raw HTML omitted --></strong>Â bytes of array(primes array) which isÂ roughlyÂ <strong>22 MB</strong> which is obviously far better thanÂ <strong>95 MB</strong> ðŸ˜ƒ</p>

            </div>
        </article>
    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/images/author.jpg" class="intro-circle" width="128" alt="Rimon Mostafiz" /></a>
      
    
    
      <header>
        <h2>Rimon Mostafiz</h2>
        <p><i class='fa fa-hand-peace-o'></i></p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/rimonmostafiz" target="_blank" title="GitHub" class="fa fa-github"></a></li>





  <li><a href="//stackoverflow.com/users/4426099" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>





















  <li><a href="//linkedin.com/in/rimonmostafiz" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>











  <li><a href="//facebook.com/rimonmostafiz" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>





  <li><a href="//reddit.com/user/rimonmostafiz" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>









  <li><a href="//api.whatsapp.com/send?phone=%2b8801711483387" target="_blank" title="WhatsApp" class="fa fa-whatsapp"></a></li>













  <li><a href="//twitter.com/rimonmostafiz" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



















  <li><a href="mailto:rimonmostafiz@gmail.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/get-insulted-by-sudo/">Get Insulted by sudo</a>
              </h3>
              
              <time class="published" datetime='2018-07-30'>
                July 30, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/manage-npm-global-packages/">Manage npm Global Packages</a>
              </h3>
              
              <time class="published" datetime='2018-07-29'>
                July 29, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/goodbye-wordpress-welcome-to-hugo/">Goodbye Wordpress, Welcome to HUGO</a>
              </h3>
              
              <time class="published" datetime='2018-07-27'>
                July 27, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/install-and-manage-node-js-using-nvm/">Install and Manage Node JS Using NVM</a>
              </h3>
              
              <time class="published" datetime='2018-07-07'>
                July 7, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/spring-bean-wiring-using-javaconfig/">Spring Bean Wiring Using Javaconfig</a>
              </h3>
              
              <time class="published" datetime='2018-05-29'>
                May 29, 2018
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /blog/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>A software developer in love with java, golang</p>
      <a href="/about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/rimonmostafiz" target="_blank" title="GitHub" class="fa fa-github"></a></li>





  <li><a href="//stackoverflow.com/users/4426099" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>





















  <li><a href="//linkedin.com/in/rimonmostafiz" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>











  <li><a href="//facebook.com/rimonmostafiz" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>





  <li><a href="//reddit.com/user/rimonmostafiz" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>









  <li><a href="//api.whatsapp.com/send?phone=%2b8801711483387" target="_blank" title="WhatsApp" class="fa fa-whatsapp"></a></li>













  <li><a href="//twitter.com/rimonmostafiz" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



















  <li><a href="mailto:rimonmostafiz@gmail.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          Rimon Mostafiz
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

